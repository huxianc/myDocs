> [参考链接](https://www.jianshu.com/p/e13fe57b8e33)

> javascript 是单线程的，浏览器是多线程的

## 进程

> 进程，代表 CPU 所能处理的单个任务，类似工厂里的车间，由于资源有限，工厂只能将其分配给一个车间，其他车间就必须停止工作，也就是说单个 CPU 只能运行一个进程（任务），通过时间片轮转调度算法，可以实现 CPU 运行多个进程。

## 线程

> 线程，类似车间里的每一个工人，属于同一个车间的工人共享同一个资源，完成同一个任务。一个进程可以包含多个线程，多个线程共享同一个资源。

- 进程是 CPU 资源分配的最小单位。
- 线程是 CPU 资源调度的最小单位，是建立在进程的基础上的一次程序运行单位。
- 一个进程可以包含多个线程，多个线程共享进程资源。
- 单线程和多线程都是在同一个进程之内。

> JS 任务分为同步任务以及异步任务，同步任务会在执行栈中顺序执行，而异步任务则会放到任务队列里，等待 JS 引擎线程空闲之后才会将这些异步任务依次推入到执行栈中，供 JS 引擎线程执行

- 对于定时任务：当 JS 引擎线程执行到定时任务代码，例如 setTimeout、setInterval，JS 引擎线程会通知定时器触发线程，间隔一段时间触发一个回调函数，定时器触发线程接收消息后，进行计时，计时结束后，会将相应的回调函数交由事件触发线程，再将其放入任务队列中。

- 对于网络请求：当 JS 引擎线程执行到网络请求代码，例如 ajax、fetch，JS 引擎线程会通知异步 HTTP 请求线程，向服务器发送请求，请求结束后，若有回调函数，则会将相应的回调函数交由事件触发线程，再将其放入任务队列中。

## 宏任务

我们可以把每次在执行栈里执行的一系列代码看成一个宏任务（包括每次从事件队列里将一个回调函数放入执行栈执行）。宏任务可以包含执行整体的 script、事件回调、XHR 回调、定时器（setTimeout、setInterval、setImmediate）、IO 操作、UI render

> Tip:由于 JS 引擎线程和 GUI 渲染线程是互斥的，所以为了保证有效的进行渲染，在每次宏任务执行之后，下一次宏任务执行之前，GUI 渲染线程都会执行一次，渲染页面。

## 微任务

微任务可以看做宏任务执行完毕后立刻执行的一系列任务，它在 GUI 渲染线程执行之前执行，在每一次宏任务执行完毕后，必须执行完所有微任务才能进入下一阶段。微任务可以包含 Promise 回调、MutationObserver、process.nextTick、Object.observe 等。

整体流程为： 宏任务 => 微任务 => 渲染 => 宏任务 => .......
